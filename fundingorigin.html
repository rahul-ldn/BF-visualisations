<head>
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.7.0/dist/Chart.min.js"></script>
<script src="https://rahulsindc.github.io/BF-visualisations/belmont-forum.style.js"> </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

</head>

<body>

  
  <canvas id="fundingorigins" height="300"></canvas>
  
  <script>
    
    
    
    //This array should be populated from BFGO data
    function FunderData() {
      var funderinfo = [
        ["BMBF",55],
        ["CNR",146],
        ["CSIRO", 257],
        ["DFG", 239],
        ["EC",  140],
        ["FAPESP",  175],
        ["Finland - Academy of Finland",50],
        ["Formas",  50],
        ["MESRI", 100],
        ["MEXT",  100],
        ["MINCyT",  20],
        ["MINECO",  40],
        ["MoES",  10],
        ["NERC",  375],
        ["NSERC", 299],
        ["NSF", 374],
        ["NSFC",  389],
        ["NWO", 27],
        ["RCN", 2],
        ["RFBR",  19],
        ["TUBITAK", 140]
      ];
      return funderinfo;
    }


  var fundingdata = FunderData();


// The number of projects in the CRA
  var numfunders = fundingdata.length;

   var funderlist = [];
  for (var i = 1; i <numfunders; i++) {
    funderlist.push(fundingdata[i][0]);
  }

  var funders = [];
  var funder_light_colours = [];
  var funder_dark_colours = [];
  var contribtotal = 0;
  var contributions = [];
  for (var i = 0; i < numfunders; i++){
    contributions[i] = fundingdata[i][1];
    contribtotal += contributions[i];
    funders[i] = fundingdata[i][0];
    funder_dark_colours[i] = BF_member_colour(funders[i],"dark");
    funder_light_colours[i] = BF_member_colour(funders[i],"light");
//    document.write(projects + " "+rdata[i]+ " "+tdata[i] + "<BR>");
  }    
contribtotal = contribtotal+ ' K \u20AC';
    
     Chart.pluginService.register({
  beforeDraw: function(chart) {
    var width = chart.chart.width,
        height = chart.chart.height,
        ctx = chart.chart.ctx;

    ctx.restore();
    var fontSize = (height / 414).toFixed(2);
    ctx.font = fontSize + "em sans-serif";
    ctx.textBaseline = "middle";

    var text = "T2S Total: "+contribtotal,
        textX = Math.round((width - ctx.measureText(text).width) / 2),
        textY = height / 2;

    ctx.fillText(text, textX, textY);
    ctx.save();
  }
});

var ctx = document.getElementById("fundingorigins");
var myChart = new Chart(ctx, {
  type: 'doughnut',

  data: {
    labels: funders,
    datasets: [{
      data: contributions,
      backgroundColor: funder_light_colours,
      borderColor: funder_dark_colours,
      borderWidth: 1,
      datalabels: {
            formatter : function(value, context) {
                var result = numeral(value).format('($0,0[.]]00 a)');
                return context.chart.data.labels[context.dataIndex]+'\n'+result;

            },
            backgroundColor: function(context) {
              return context.dataset.backgroundColor;
            },
            borderColor: 'white',
            borderRadius: 25,
            borderWidth: 3,
            anchor: 'end',
            color: 'white',
            font: {
              weight: 'bold'
            }
       
          },
  }],
},
      
options: {
    legend: {
    display: false,

  },
 /* tooltips: {
    callbacks: {
      label: function(tooltipItem, data) {
                    return (data.datasets[tooltipItem.datasetIndex].labels + ": " + numeral(tooltipItem.yLabel).format('(0,0[.]]00 a)')+ 'K \u20AC')
                }
            }
        }, */
  cutoutPercentage: 55,
  animateRotate: "true"

}
}
);
  </script>
</body>
