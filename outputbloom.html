<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.7.0/dist/Chart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>

 <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
     <script src="https://rahulsindc.github.io/BF-visualisations/belmont-forum.style.js"> </script>
  <!-- Numeric.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
  
 </head>

<body>
  <div id="outputbloom">
    <div class="wrapper"><canvas id="outputbloom-chart"></canvas></div>
  </div>
  
  <script>
    
    // Columns fixed by table definition; 
    //Project Abbreviation,
    //Project Name,
    //People (currently unpopulated/not revealed/unimplemented)
    //Research Outputs (papers/datasets), 
    // In Person Engagements (trainings, conference presentations)
    //Remote/Distributed Engagement (press mentions)
    
    //This array should be populated from BFGO data
    function BFGOoutputdata() {
      var outputdata = [
        ["TAMANI","TAMANI",530,4,5,0],
        ["ASUS","ASUS",1001210,4,2,0],
        ["CONNECT","CONNECT",0,0,1,0],
        ["RACArctic","RACArctic",310,2,3,0],
        ["ARCTIC-ERA","ARCTIC-ERA",130,2,1,0],
        ["BAAMRGP","BAAMRGP",630,5,4,0],
        ["COPERA","COPERA",1140,5,3,0],
        ["HIARC","HIARC",1230,3,3,0],
        ["Pan-Arctic Options","Pan-Arctic Options",1230,5,3,0]
      ];
      return outputdata;
    }


  var outputbloomdata = BFGOoutputdata();
  projects_short = [];
  projects_long = [];
  audience_data = [];
  publications_data = [];
  presentations_data = [];
  audience_colours = [];
  publications_colours = [];
  presentations_colours = [];

  for (var current_project = 0; current_project<outputbloomdata.length; current_project++) {
    projects_short.push(outputbloomdata[current_project][0]);
    projects_long.push(outputbloomdata[current_project][1]);
    audience_data.push(Math.log(outputbloomdata[current_project][2]));
    publications_data.push(outputbloomdata[current_project][3]);
    presentations_data.push(outputbloomdata[current_project][4]);
    audience_colours.push(BF_T2S_project_colour(projects_short[current_project],"light"));
    presentations_colours.push(BF_T2S_project_colour(projects_short[current_project],"medium"));
    publications_colours.push(BF_T2S_project_colour(projects_short[current_project],"dark"));

  }

console.log("Publications");
console.log(publications_data);
console.log("Presentations");
console.log(presentations_data);
console.log("Audience Size");
console.log(audience_data);
                                                    
var chart = new Chart('outputbloom-chart', {
      type: 'polarArea',
      data: {
        labels: projects_short,
        datasets: [{
          backgroundColor: publications_colours,
          data: publications_data,
          borderColor : publications_colours,
        }, {
          backgroundColor: presentations_colours,
          data: presentations_data,
          borderColor : publications_colours,

        }, {
          backgroundColor: audience_colours,
          data: audience_data,
          borderColor : publications_colours,

        }]
      },
      options: {
        legend: {
          display: true,
          position: 'right',
          labels: {
            fontSize: 14,
            fontStyle: 'bold',
          },
        },
        scales : {
          xAxes: [{
            stacked: true,
//            ticks: [{
//              beginAtZero:  true,
//            }],
          }],
          yAxes: [{
            stacked: true,
 //           ticks: [{
 //             beginAtZero:  true,
 //           }],
          }],
        },
        plugins: {
          datalabels: {
            anchor: 'end',
            align: 'center',
            backgroundColor: function(context) {
              return context.dataset.backgroundColor;
            },
            borderColor: 'white',
            borderRadius: 25,
            borderWidth: 2,
            color: 'white',
            font: {
              weight: 'bold'
            },
            formatter: Math.round
          }
        }
      }
    });

  </script>
</body>
